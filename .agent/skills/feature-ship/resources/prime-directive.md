# ANTIGRAVITY PRIME DIRECTIVE

## LAW 1: THE FAILPROOF LOOP
YOU MUST follow this sequence for EVERY feature or logic change:
1.  **PLAN:** Create `plan.md`. User must approve it before you proceed.
2.  **VERIFY:** Read `verification-db.md` (in resources) and define the exact test for this task.
3.  **EXECUTE:** Write the code.
4.  **VALIDATE:** Execute the verification test. If it fails, FIX IT. Do not proceed until it passes.

## LAW 2: UI GENERATION PROTOCOL
YOU MUST generate ALL UI components using the **21st.dev Magic MCP** tool. Do not write raw CSS/HTML for components from scratch.
- **Aesthetic Rule:** Default to "Void Aesthetic" (Deep Purple, Glassmorphism) unless specified otherwise.
- **Fidelity Rule:** Implement generated UI code EXACTLY as provided before making any refactoring changes.

## LAW 2.1: NO CREATIVE DEVIATION (Magic MCP Fidelity)
YOU MUST adhere to these rules when modifying UI:
1.  **REUSE FIRST:** If refactoring or extending UI, you MUST locate and reuse existing components generated by the Magic MCP. Do not create new components from scratch.
2.  **ZERO PRESUMPTION:** If no suitable Magic-generated component exists, you MUST STOP and present your proposed code/plan to the user for explicit validation BEFORE writing any new UI code.
3.  **USER GATE:** The command "Proceed with your plan" or equivalent from the user is REQUIRED to continue after a stop.

## LAW 3: CONTRACT-FIRST DEVELOPMENT
YOU MUST define and lock API/data contracts in `contracts/*.ts` BEFORE writing frontend or backend logic. Do not start coding without a contract.

## LAW 4: SECURITY FIRST (OWASP CORE)
YOU MUST:
- Validate & sanitize ALL user input with `zod` or `Pydantic`.
- Store ALL secrets (API keys, DB URLs) in `.env` files. NEVER commit them.
- Use structured logging. NEVER expose stack traces or system errors to users.

## LAW 5: TOOL MAXIMIZATION
YOU MUST use ALL configured MCP tools where relevant:
- `magic` for UI.
- `github` for repository operations.
- `postgres` or `supabase` for database operations.
- `context7` for documentation and best practice checks.

## LAW 6: KNOWLEDGE COMPOUNDING
AFTER FIXING ANY ERROR, YOU MUST immediately append the solution to `.agent/skills/feature-ship/resources/verification-db.md` in the "Troubleshooting" section.

## LAW 7: RESOURCE OPTIMIZATION PROTOCOL (21st.dev)
YOU MUST optimize the use of the 21st.dev Magic MCP according to these rules:

### 7.1 Strategy Selection
At the start of the **PLAN** phase for any task involving UI, YOU MUST present the user with a clear choice:
1.  **Cost-Effective Path:** Prioritize free resources and minimal generations.
2.  **Full-Generation Path:** Generate the complete UI in dedicated commands.
3.  **Use Existing UI:** The user will provide an exact, pre-generated Magic MCP prompt and expects you to implement that specific output.
YOU CANNOT proceed with UI planning until the user selects a path.

### 7.2 The Thrifty Rules (If Cost-Effective Path is chosen)
If the user selects "Cost-Effective Path," YOU MUST strictly follow:
1.  **INSPIRATION FIRST (Free):** BEFORE generating anything, search the 21st.dev **Inspirations** library for matching components. If a component matches â‰¥80% of requirements, you MUST use and adapt it via code edits.
2.  **LOGIC SEPARATION:** Use the Magic MCP **only** for Visual/React component structure and styling. You MUST write all backend logic, state management, and business rules using standard coding.
3.  **BATCHING:** Group related UI elements (e.g., an entire Dashboard layout) into a SINGLE generation request. You MUST NOT generate "Sidebar", "Header", and "Card" separately.

### 7.3 The Implementation Rules (If Use Existing UI Path is chosen)
If the user selects "Use Existing UI," YOU MUST strictly follow:
1.  **NO SEARCH, NO GENERATE:** You MUST NOT search the Inspirations library. You MUST NOT use the Magic MCP to generate new components. This path has a **GENERATION COST OF ZERO**.
2.  **USER PROVIDES PROMPT:** The user will provide the exact prompt used to generate the UI. You MUST request this prompt if not given.
3.  **IMPLEMENT EXACTLY:** Your ONLY task is to implement the code that the provided Magic MCP prompt would have generated. You must adapt it to fit the current project's data contract and file structure, but you MUST preserve the core visual design, components, and layout specified in the prompt.
3.  **EFFICIENCY FOCUS:** All effort is directed at integration and wiring. The creative UI work is considered complete.

## LAW 8: TEMPLATE REPOSITORY PROTOCOL
The `antigravity-failproof-template` repository is a STARTER TEMPLATE ONLY. YOU MUST:
1.  **NEVER COMMIT PROJECT CODE** to the template repository directly.
2.  **CREATE NEW REPO:** For each new project, create a new GitHub repository using the GitHub MCP.
3.  **COPY TEMPLATE FILES:** Copy `agy/rules.md`, `VERIFICATION.md`, and `.agent/workflows/` to the new project.
4.  **UPDATE GIT REMOTE:** Point the local project to the new repository before committing.
